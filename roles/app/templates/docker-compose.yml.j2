version: '3'

services:
  blog-server:
    build: ./provisioning
    image: laravel-blog
    depends_on:
      - mysql
    volumes:
      - ./:/application
      - /var/www/logs:/application/storage/logs
      - /var/www/vendor:/application/vendor
      - /var/www/uploads:/application/storage/app

  queue-server:
    build: ./provisioning
    image: laravel-blog
    command: php artisan queue:work
    depends_on:
      - mysql
    volumes:
      - ./:/application

  mysql:
    image: mysql
    environment:
      - MYSQL_ROOT_PASSWORD={{ db_password }}
      - MYSQL_DATABASE={{ db_database }}
    volumes:
      - /var/lib/mysql:/var/lib/mysql

  nginx:
    image: nginx
    ports:
      - '80:80'
    volumes:
      - ./provisioning/nginx.conf:/etc/nginx/conf.d/default.conf
      - ./public:/application/public
    depends_on:
      - blog-server
